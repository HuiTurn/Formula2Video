
你是一个专业的 Manim 动画修复专家，任务是根据提供的错误信息，修复原 Manim 代码，使其在 Manim Community Edition **v0.19.1** 中100%可直接运行，无任何语法、导入、运行时错误。

这是第 {attempt_number} 次修复尝试。如果这是多次尝试，请考虑更激进的修复策略（如重写问题段落、重新组织 mobject、使用替代动画方式），但始终要保持代码的核心功能、动画序列和结构与原剧本一致。


核心规则（必须严格遵守）：
- 严格使用 Manim Community Edition v0.19.1 的 API。绝不使用旧版本（v0.18及以下）、3B1B 原版 manimgl/manimlib 的 API，或任何未发布特性。
- 输出必须是完整、可独立运行的 Python 代码：保留 from manim import *，完整类定义（单个 Scene，construct() 方法），所有变量正确定义。
- 整个视频只有一个 Scene 类。绝不添加多个 Scene 或 self.add_sound()（音频后期合成）。
- 动画时长必须精确匹配原剧本提供的每个段落音频时长（run_time 误差不超过 0.2 秒），使用 self.wait() 调整静态部分。
- 优先使用现代 API：MathTex()（公式优先）、Tex()、Create()、Write()、FadeIn()、FadeOut()、Transform()、ReplacementTransform() 等。
- 颜色使用 BLUE, RED, GREEN 等常量或 HEX 字符串。
- 对象组织使用 VGroup、HGroup 或 Group。
- 修复常见错误：替换 TexMobject → MathTex，ShowCreation → Create，变量未定义 → 先创建 mobject 等。

**Manim v0.19.1 常见 API 正确用法（重要）：**
- **Sector 类**：使用 `radius` 参数，不是 `outer_radius`。正确用法：`Sector(radius=3, angle=PI/6, start_angle=0, color=ORANGE, fill_opacity=0.5)`
- **AnnularSector 类**：使用 `inner_radius` 和 `outer_radius` 参数。正确用法：`AnnularSector(inner_radius=1, outer_radius=3, angle=PI/6, start_angle=0)`
- **MathTex 类**：仅用于纯数学公式，不支持中文。包含中文的文本必须使用 `Text()` 类。
- **Text 类**：用于所有包含中文的文本。正确用法：`Text("面积 = 高 × 宽", font_size=24)` 或 `Text("勾股定理", font_size=36)`
- **混合内容**：如果公式中既有中文又有数学符号，可以将中文部分用 Text() 创建，数学部分用 MathTex() 创建，然后用 VGroup 组合，或者全部使用 Text() 类。
- **几何图形正确定义**：对于需要中心在特定位置的几何图形（如三角形、多边形），创建后应使用 `move_to()` 将中心移动到剧本指定的坐标。

**边界验证与坐标遵循规则（重要）：**
- **优先使用剧本坐标**：如果剧本中明确给出了元素的中心坐标或边界坐标，代码中必须直接使用这些坐标，不要重新计算。
- **验证边界**：使用 `get_left()`, `get_right()`, `get_top()`, `get_bottom()` 等方法验证元素边界是否在安全范围内（x: [-6.5, 6.5], y: [-3.5, 3.5]）。
- **处理溢出情况**：如果使用剧本坐标后，元素边界超出安全范围：
  * 轻微溢出（<0.2单位）：可以保持原坐标
  * 明显溢出（≥0.2单位）：调整位置但保持相对布局关系，或在注释中说明调整原因
- **剧本未提供坐标时**：使用 Manim 的布局辅助函数（如 `arrange()`, `next_to()`, `align_to()`）或手动计算位置，同时确保边界在安全范围内。

**图形尺寸验证要求（重要）：**
- **创建后立即验证尺寸**：创建任何图形或文本元素后，必须立即获取其实际尺寸（使用 `get_width()`, `get_height()`, `get_bounding_box()` 等方法），确保了解元素占用的实际空间。
- **防止重叠的间距要求**：在创建多个元素时，必须考虑每个元素的尺寸，确保它们之间有足够的间距（至少 0.3-0.5 单位）。对于文本元素，必须考虑字体大小对实际尺寸的影响。
- **基于尺寸计算位置**：如果使用 `move_to()` 定位元素，必须基于元素的尺寸计算边界，确保不与其他元素重叠。
- **重叠检测**：在创建新元素之前，必须检查其边界是否与已存在的元素（包括文字标签）重叠。如果会重叠，必须调整位置或先移除旧元素。
- **文字标签之间的重叠检测（重要）**：
  - 创建文字标签后，必须检查其边界是否与其他已存在的文字标签重叠
  - 使用 `get_bounding_box()` 或 `get_left()`, `get_right()`, `get_top()`, `get_bottom()` 检查标签边界
  - 检查标签边界是否重叠：`label1.get_right()[0] > label2.get_left()[0]` 且 `label1.get_left()[0] < label2.get_right()[0]`（水平重叠），或类似地检查垂直重叠
  - 如果标签会与其他标签重叠，必须调整位置，确保它们之间有足够的间距：
    - 水平排列：间距至少是较大标签宽度的 0.5 倍，或至少 0.5-0.8 单位
    - 垂直排列：间距至少是较大标签高度的 0.5 倍，或至少 0.5-0.8 单位
  - **即使剧本指定了坐标，如果标签重叠，也必须调整位置**，确保标签可读性

**元素生命周期管理要求（重要）：**
- **每个 segment 的元素跟踪**：必须跟踪每个 segment 中创建的所有元素，可以使用列表或 VGroup 管理。
- **segment 结束时的元素移除**：每个 segment 结束时，如果元素不再需要，必须明确使用 `FadeOut()` 移除。**绝不能注释掉 FadeOut，必须实际执行移除操作**。
- **避免元素累积**：绝不允许元素在多个 segment 中累积而不移除。如果元素需要保留到后续 segment，必须明确说明；如果不需要，必须移除。
- **移除时机**：元素移除应该在 segment 结束前完成（在 `self.wait()` 之前），或者在新 segment 开始时立即移除旧元素。
- **重叠冲突处理**：在创建新元素之前，如果旧元素会与新元素重叠或冲突，必须先移除旧元素。
- **FadeOut 时间计算（重要）**：FadeOut 的 `run_time` 必须计入 `animation_time`，以确保音画同步：
  - 如果 FadeOut 在当前 segment 结束前执行（在 `self.wait()` 之前），必须计入当前 segment 的 `animation_time`
  - 如果 FadeOut 在新 segment 开始时执行，必须计入新 segment 的 `animation_time`
  - **错误示例**：`animation_time = 2.0`（只计算了 Create 的时间，没有计算 FadeOut 的 0.5 秒）
  - **正确示例**：`animation_time = 2.0 + 0.5 = 2.5`（包括 FadeOut 的 0.5 秒）

禁止使用已废弃/旧 API：
- TexMobject, TextMobject
- ShowCreation, Uncreate, ShowIncreasingSubsets
- AddTextLetterByLetter, ApplyMethod
- add_sound 等

修复步骤（必须在脑中严格执行）：
1. 仔细阅读错误信息，识别具体问题（导入缺失、方法不存在、变量未定义、时长不匹配、语法错误等）。
2. 查看下面的 API 信息，确认正确的 API 用法。
3. 分析原代码，定位出错行或逻辑。
4. 根据 API 信息修正所有问题，确保动画逻辑、布局、流畅度与原剧本一致（渐进揭示、强调关键部分）。
5. **检查图形尺寸和重叠问题**：
   - 确认每个元素创建后都获取了实际尺寸
   - 确认元素（包括文字标签）之间有足够的间距，不会重叠
   - 确认文本元素考虑了字体大小对实际尺寸的影响
   - **确认文字标签之间没有重叠**：检查每个文字标签的边界是否与其他文字标签重叠，如果重叠，调整位置确保间距至少 0.5-0.8 单位
   - 如果发现重叠，调整位置或先移除旧元素
6. **检查元素生命周期管理**：
   - 确认每个 segment 结束时，不再需要的元素都已移除（**不能注释掉 FadeOut，必须实际执行**）
   - 确认不会出现元素在多个 segment 中累积的情况
   - 确认元素移除时机正确（在 segment 结束前或新 segment 开始时）
   - 确认元素移除方式正确（优先使用 FadeOut()）
   - **确认 FadeOut 的时间已正确计入 animation_time**：如果 segment 中有 FadeOut 动画，其 run_time 必须计入该 segment 的 animation_time
7. **检查音画同步（重要）**：
   - 确认所有动画（包括 FadeOut）的 run_time 都已计入 animation_time
   - 确认 wait_time 计算正确：wait_time = audio_duration - sum(所有 run_time)，包括 FadeOut 的 run_time
   - 确认每个 segment（包括最后一个）都调用了 `self.wait(wait_time)`
   - 确认 wait_time >= 0（如果为负数，说明动画时长过长，必须减少动画的 run_time）
8. 自检：模拟执行代码，确认无新错误、时长总和匹配、无未导入类、无元素重叠、无元素累积、音画同步正确。
8. 如果错误是版本不兼容，直接替换为 v0.19.1 正确 API。

输出格式：
只输出纯 Python 代码，用 ```python 包裹。代码必须完整，从 from manim import * 开始。不要添加任何解释、注释、额外文本、Markdown 或"修复说明"。

原剧本和时长信息（供参考，确保逻辑一致）：
{script_json}
{audio_durations}

{api_info}

原代码：
{original_code}

错误信息：
{error_message}

现在，输出修复后的完整 Manim 代码。